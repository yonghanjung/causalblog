# 2. 인과관계 확률변수 $Y_x$ 

이번 글에서는, 인과관계 (Causation)의 개념을 수학적 기호 (notation) 을 적용하여 설명하고자 합니다. 저번 글의 예시를 활용하여, 관심있는 원인변수 $X=0$ 은 운동을 안함 / $X=1$ 은 운동을 함 이라고 정의하겠습니다. $Y$ 는 콜레스테롤 수치라고 정의하겠습니다. 우리가 관심있게 분석하고자 하는 환자들의 모집단을 $\Pi$ 라고 하겠습니다. 



## Ceterius paribus: 다른 모든 조건이 동일할 때 

경제학/예방의학 등의 학문에서는 ***ceterius paribus*** ('다른 모든 조건이 동일할 때' 를 뜻하는 라틴어) 라는 널리 사용되는 가정이 있습니다. $X,Y$ 두 변수 사이의 관계를 설명할 때, 제 3의 변수 ($Z$) 가 개입하여 $(X,Y)$ 사이의 관계를 혼동시키는 것을 막기 위해서, 다른 모든 조건 (i.e., $Z$)이 동일할 때, $X$가 변하면  $Y$가 어떻게 변하는지 설명하기 위한 조건입니다.  [1. 상관관계와 인과관계](https://github.com/yonghanjung/causalblog-Kor/blob/master/Journey%20to%20SCM/1.%20%EC%83%81%EA%B4%80%EA%B4%80%EA%B3%84%EC%99%80%20%EC%9D%B8%EA%B3%BC%EA%B4%80%EA%B3%84.md) 에 소개된 예시에 이 조건을 적용하면 ‘연령’ 이라는 제 3의 변수가 (운동, 콜레스테롤) 의 관계를 혼동시키고 있는 것을 알 수 있습니다. 이를 막기 위해서 우리는 ‘*다른 모든 조건이 동일할 때*’ 운동과 콜레스테롤의 관계를 보아야 합니다. $X$ 를 제외한 다른 모든 요소가 동일하다면, $Y$ 의 변화를 유발시키는 유일한 요소는 $X=x$ 이기 때문에 이 확률변수는 직관적으로 인과관계를 함의한다고 생각할 수 있습니다. 

이 직관을 수학적 개념으로 엄밀히 발전시킨 사람은 [Donald Rubin](https://en.wikipedia.org/wiki/Donald_Rubin) 입니다. $X,Y$ 가 각각 관심있는 원인, 결과에 해당하는 변수일 때, Rubin 은 <span style="color:blue">다른 모든 상황이 동일할 때, X가 변화할 때 확률변수 Y </span>를 표현하기 위해 $Y_{X=x}$ (간략하게, $Y_x$) 라는 변수를 도입하여 $Y_{X=1} - Y_{X=0}$ 이라고 표현했습니다. 

이 변수를 깊이 이해하기 위해서 <span style="color:red"> X가 변화할 때 확률변수 Y </span> (즉, $(Y \vert X=1) - (Y \vert X=0)$) 와 대조하여 보겠습니다.  조건부 확률변수 $Y \vert X=x$ 은 모집단에 속한 환자 중 $X=x$ 인 환자들만 모아 놓은 부분모집단 $\Pi_{X=x}$  에서 정의되는 확률변수 $Y$ 입니다. 한 마디로 조건부 확률변수는 축소된 sample space 에서 정의된 확률변수를 말합니다. [그림 1]은 이 논의를 시각화하여 표현합니다. 

| <img src="Figure/conditional.png" width="500px"> |
| :----------------------------------------------: |
|       [그림 1] 확률변수 $Y\vert X=x$         |

위 그림에서, $Y\vert X=0$, $Y \vert X=1$ 은 각각 shaded area 에서 정의되는 확률변수 $Y$ 를 의미합니다. 

한편, 조건부 확률변수의 차이 $(Y \vert X=1) - (Y \vert X=0)$ 은 <span style="color:blue">모든 조건이 동일할 때, X가 변할 때 확률변수 Y </span> 를 의미하지는 않습니다. 왜냐하면, $Y \vert X=0$ 과 $Y \vert X=1$ 이 정의된 부분모집합 (shaded area) 들이 '<span style="color:red">다른 모든 조건이 동일할 때 </span> 조건을 만족할리 없기 때문이죠 (즉, $\Pi_{X=0} \neq \Pi_{X=1}$). 조건부 확률변수 $Y \vert x$ 는 Rudin 의 변수 $Y_x$ 와 같지 않습니다. 

한편, $Y_{X=x}$ 는 '모든 모집단의 환자들이 X=x 라고 가정할 때'  확률변수 $Y$ 를 의미합니다. 구체적으로, 모집단 $\Pi$ 에 대해서 모든 모집단의 구성원들이 $X=x$ 라고 가정한 *가상모집단* $\Pi^{X=x}$ 의 확률변수 $Y$ 를 말하죠. [그림 2] 는 다음과 같은 설명을 시각화하여 표현합니다. 

| <img src="Figure/hypothetical.png" width="500px"> |
| :----------------------------------------------: |
|       [그림 2] 확률변수 $Y_{x}$         |

이 정의는 <span style="color:blue">모든 조건이 동일할 때 X=x 일 때 Y </span> 를 만족합니다. 왜냐하면, $\Pi^{X=0}$ 와 $\Pi^{X=1}$ 은 다른 모든 조건이 동일하고 오직 $X=x$ 만 다르기 때문이죠. 

정리하면 다음과 같습니다. 

* $Y \vert X=x$ 는 모집단 $\Pi$ 중 $X=x$ 를 가지는 부분모집단 $\Pi_{X=x}$ 에서 정의되는 확률변수 $Y$; 
* $Y_{X=x}$ 는 모집단 $\Pi$ 의 모든 구성원이 $X=x$ 를 가진다고 *가정*할 때 (가상모집단 $\Pi^{X=x}$) 정의되는 확률변수 $Y$. 



## Potential outcome $Y_x$ 

저희가 지금껏 공부한 Causal effect 를 나타내는 변수 $Y_x$ 는 공식적으로 *potential outcome*  이라고 불립니다. 왜 이렇게 불리는지 살펴보고, 이번 글을 마치고자 합니다. 

위에서 $Y_{x}$ 는 모집단 $\Pi$ 의 모든 구성원이 $X=x$ 를 가질 때 정의된다고 하였습니다. 만일, 저희가 관심있어 하는 집단이 부분모집단 $\Pi_{X=x}$ 이면 어떨까요? 위의 정의에 따라서, 부분모집단 $\Pi_{X=x}$ 에서 관측되는 $Y$ 는 곧 인과적 해석이 가능한 $Y_x$ 입니다. 그리고 동시에, 부분모집단의 정의에 따라서 이 확률변수는 조건부 확률변수 $Y \vert x$ 이기도 하죠. 다시 말해서, 다음 수식이 성립합니다.
$$
(Y \vert x) = (Y_x \vert x).
$$

위의 예시를 통해 설명하자면, 운동을 하는 환자들의 집단 $\Pi_{X=1}$ 에서는 환자들이 운동을 할 때 콜레스테롤 수치인 $Y_{X=1}$ 을 관측할 수 있고, 운동을 하지 않는 집단 $\Pi_{X=0}$ 에서는 환자들이 운동을 안 할 때 콜레스테롤 수치인 $Y_{X=0}$ 을 관측할 수 있습니다. 즉, $Y_{X=1} \vert X=1$ 과 $Y_{X=0} \vert X=0$ 이 관측 가능하죠. 이러한 성질을 Causal inference 분야에서는 **Consistency** 라고 부릅니다. 

하지만, 비교가능성을 위해서는, $Y_{X=0} \vert X=1$ 과 $Y_{X=1} \vert X=0$ 역시 필요합니다. 즉, 운동을 하는 환자들을 모아놓은 $\Pi_{X=1}$ 에서 환자가 *운동을 하지 않을 때* 콜레스테롤 변수 $Y$ 가 필요하죠. 당연하게도, 이런 변수는 관측데이터에 존재할 수 없습니다. 이미 *운동을 했다* 가 주어진 상황에서 '운동을 하지 않았다면?' 에 관한 관측은 존재할 수 없겠죠. 

이렇듯, $Y_{x}$ 는 $X=x$ 가 주어진 상황에서만 관측됩니다. 그리고 $X=x$ 가 주어져 있다면, $Y_{x'}$ ($x \neq x'$) 는 관측될 수 없고, 잠재적으로만 존재합니다. 이러한 현상에 주목하여, Rudin 은 $Y_x$ 를 Potential outcome 이라고 불렀습니다. 



## 요약 

복잡하고 어려운 이야기를 했기 때문에, 세 줄 요약을 하면 다음과 같습니다. 

* $Y \vert X=x$ 는 모집단 $\Pi$ 중 $X=x$ 를 가지는 부분모집단 $\Pi_{X=x}$ 에서 정의되는 확률변수 $Y$; 
* $Y_{X=x}$ 는 모집단 $\Pi$ 의 모든 구성원이 $X=x$ 를 가진다고 *가정*할 때 (가상모집단 $\Pi^{X=x}$) 정의되는 확률변수 $Y$. 이 변수는 Ceterius paribus 원칙을 만족하기 때문에, $X=x$ 가 $Y$ 에 미치는 인과적 영향이라고 해석될 수 있는 인과변수이다. 
* $Y_{x}$ 는 potential outcome 이라고 불리며, $X=x$ 가 주어진 상황에서만 관측된다. 



현실에서는 $Y_x$ 를 무작위 실험 (Randomized controlled trial) 을 통해서 관측하고 계산합니다. 이러한 실험디자인과 이 디자인에 담긴 아이디어를 [다음 글](https://github.com/yonghanjung/causalblog-Kor/blob/master/Journey%20to%20SCM/3.%20%EB%AC%B4%EC%9E%91%EC%9C%84%EC%8B%A4%ED%97%98%20(RCT).md)에서 살펴보고자 합니다. 

